# Cilium eBPF uProbe Demo

This folder contains a demo showcasing the usage of uProbe with Cilium eBPF for Go applications.
The demo consists of a simple Go application and a tracing application that utilizes eBPF to trace the execution of a specific function in the Go application.

## Table of Contents
1. [Directory Structure](#directory-structure)
2. [Running the Demo](#running-the-demo)
3. [Makefile Commands](#makefile-commands)
4. [Code Overview](#code-overview)

## Directory Structure
```
uprobe/
├── server/           # Directory containing the Go application
│   └── server.go     # Go application source code
├── tracer/           # Directory containing the tracing application
│   ├── main.go       # Tracing application source code
│   ├── trace.c       # eBPF program source code
│   └── bpf_bpfel.go  # Generated Go code from eBPF program
│   └── bpf_bpfeb.go  # Generated Go code from eBPF program
├── Makefile          # Makefile for building and running the demo
└── README.md         # This README file
```

## Running the Demo
1.	Build the application and the tracer:
``make all``
2. Run the Go application:
``make run-app``
3. In a new terminal, run the tracer with sudo privileges:
``sudo make run-tracer``
4. Acess the Go application with cURL:
``curl localhost:8090?arg=42``
5. Observe the tracer output in the terminal running the tracer.

## Makefile Commands
You can use `make help` to see all available commands.

## Code Overview

### Go Application
The Go application (`server/server.go`) is a simple HTTP server with one endpoint that accepts a query parameter arg and passes it to the demo function, which prints the value of arg.

### Tracing Application
The tracing application (`tracer/main.go`) sets up a uProbe to trace the demo function in the Go application. It uses a ring buffer to read events generated by the eBPF program.

### eBPF Program
The eBPF program (`tracer/trace.c`) defines the event structure and the uProbe function that reads the argument passed to the demo function and submits it to the ring buffer.
